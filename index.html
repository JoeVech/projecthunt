<!DOCTYPE html>
<html>
<head>
    <title>GeoHunter Ultimate</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="controls">
        <button onclick="locateUser()">üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
        <button onclick="switchStyle()">üîÑ –°–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å</button>
    </div>

    <!-- –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è MapLibre -->
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet">

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
        const mapStyles = [
            {
                name: "OpenStreetMap",
                url: "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            },
            {
                name: "ArcGIS",
                url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",
                attribution: '¬© Esri'
            },
            {
                name: "NASA Gibs",
                url: "https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/BlueMarble_ShadedRelief_Bathymetry/default//GoogleMapsCompatible_Level8/{z}/{y}/{x}.jpg",
                attribution: '¬© NASA'
            }
        ];

        let currentStyle = 0;
        let map;

        function initMap(lng, lat) {
            map = new maplibregl.Map({
                container: 'map',
                style: {
                    version: 8,
                    sources: {
                        'raster-tiles': {
                            type: 'raster',
                            tiles: [mapStyles[currentStyle].url],
                            tileSize: 256,
                            attribution: mapStyles[currentStyle].attribution
                        }
                    },
                    layers: [{
                        id: 'simple-tiles',
                        type: 'raster',
                        source: 'raster-tiles',
                        minzoom: 0,
                        maxzoom: 19
                    }]
                },
                center: [lng, lat],
                zoom: 12
            });

            // –ú–∞—Ä–∫–µ—Ä –∏–≥—Ä–æ–∫–∞
            const marker = new maplibregl.Marker({
                color: "#4CAF50",
                scale: 1.2
            })
            .setLngLat([lng, lat])
            .addTo(map);

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            map.on('error', (e) => {
                console.error('Map error:', e.error);
                switchStyle();
            });
        }

        function locateUser() {
            navigator.geolocation.getCurrentPosition(pos => {
                map.flyTo({
                    center: [pos.coords.longitude, pos.coords.latitude],
                    essential: true
                });
            }, error => {
                alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: ' + error.message);
            });
        }

        function switchStyle() {
            currentStyle = (currentStyle + 1) % mapStyles.length;
            map.setStyle({
                version: 8,
                sources: {
                    'raster-tiles': {
                        type: 'raster',
                        tiles: [mapStyles[currentStyle].url],
                        tileSize: 256,
                        attribution: mapStyles[currentStyle].attribution
                    }
                },
                layers: [{
                    id: 'simple-tiles',
                    type: 'raster',
                    source: 'raster-tiles',
                    minzoom: 0,
                    maxzoom: 19
                }]
            });
            alert('–°—Ç–∏–ª—å –∫–∞—Ä—Ç—ã: ' + mapStyles[currentStyle].name);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        Telegram.WebApp.ready();
        initMap(34.1003, 44.9482); // –°–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
        locateUser();
    </script>
</body>
</html>
