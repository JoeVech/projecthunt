<!DOCTYPE html>
<html>
<head>
    <title>Virtual Zoo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ar-js-org/ar.js@3.4.0/aframe/build/aframe-ar.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #hud {
            position: fixed;
            top: 20px;
            left: 20px;
            color: white;
            font-family: Arial;
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 10px;
        }
        #captureBtn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="hud">
        Очков: <span id="score">0</span><br>
        Животных осталось: <span id="animalsLeft">10</span>
    </div>
    
    <a-scene embedded arjs="debugUIEnabled: false">
        <a-camera></a-camera>
        <a-entity id="spawnArea"></a-entity>
    </a-scene>

    <button id="captureBtn">Поймать!</button>

    <script>
        let score = 0;
        let animalsCount = 10;
        const animals = [
            { 
                model: 'https://cdn.jsdelivr.net/gh/aframevision/3d-models@main/animals/lowpoly_deer.glb',
                scale: '0.5 0.5 0.5',
                points: 10
            },
            {
                model: 'https://cdn.jsdelivr.net/gh/aframevision/3d-models@main/animals/lowpoly_rabbit.glb',
                scale: '0.3 0.3 0.3',
                points: 5
            }
        ];

        // Инициализация
        Telegram.WebApp.ready();
        
        // Генерация животных
        function spawnAnimal() {
            if (animalsCount <= 0) return;

            const animal = animals[Math.floor(Math.random() * animals.length)];
            const angle = Math.random() * Math.PI * 2;
            const distance = 2 + Math.random() * 3;
            
            const animalEntity = document.createElement('a-entity');
            animalEntity.setAttribute('gltf-model', animal.model);
            animalEntity.setAttribute('scale', animal.scale);
            animalEntity.setAttribute('position', {
                x: Math.cos(angle) * distance,
                y: -1,
                z: Math.sin(angle) * distance
            });
            animalEntity.setAttribute('animation', {
                property: 'rotation',
                to: '0 360 0',
                loop: true,
                dur: 5000
            });
            animalEntity.classList.add('animal');
            animalEntity.dataset.points = animal.points;

            document.querySelector('#spawnArea').appendChild(animalEntity);
            animalsCount--;
            updateHUD();
        }

        // Проверка попадания
        function checkCapture() {
            const camera = document.querySelector('[camera]');
            const cameraPos = camera.getAttribute('position');
            
            document.querySelectorAll('.animal').forEach(animal => {
                const animalPos = animal.getAttribute('position');
                const distance = Math.sqrt(
                    Math.pow(animalPos.x - cameraPos.x, 2) +
                    Math.pow(animalPos.z - cameraPos.z, 2)
                );

                if (distance < 1.5) {
                    score += parseInt(animal.dataset.points);
                    animal.parentNode.removeChild(animal);
                    spawnAnimal();
                    updateHUD();
                }
            });
        }

        // Обновление интерфейса
        function updateHUD() {
            document.getElementById('score').textContent = score;
            document.getElementById('animalsLeft').textContent = animalsCount;
        }

        // Инициализация игры
        for (let i = 0; i < 3; i++) spawnAnimal();
        document.getElementById('captureBtn').addEventListener('click', checkCapture);

        // Автоспавн каждые 30 секунд
        setInterval(spawnAnimal, 30000);
    </script>
</body>
</html>
