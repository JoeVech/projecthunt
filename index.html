<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Camera Fix</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 1. Подключаем A-Frame ПЕРВЫМ -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    
    <!-- 2. Затем AR.js -->
    <script src="https://cdn.jsdelivr.net/npm/@ar-js-org/ar.js@3.3.0/aframe/build/aframe-ar.min.js"></script>
    
    <!-- 3. Блокируем Web3 API -->
    <script>
        window.addEventListener('load', () => {
            delete window.ethereum;
            delete window.web3;
            Object.defineProperty(window, 'ethereum', { get: () => undefined });
            Object.defineProperty(window, 'web3', { get: () => undefined });
            console.log('Web3 API blocked');
        });
    </script>
    
    <style>
        body { margin: 0; overflow: hidden; }
        .arjs-loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-family: Arial;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- 4. Индикатор загрузки -->
    <div class="arjs-loader">Инициализация AR...</div>
    
    <!-- 5. Сцена должна быть ПОСЛЕ скриптов -->
    <a-scene 
        vr-mode-ui="enabled: false"
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
        renderer="logarithmicDepthBuffer: true;"
    >
        <a-camera gps-camera rotation-reader></a-camera>
        
        <!-- Тестовый объект -->
        <a-box 
            position="0 0 -2" 
            material="color: #4CAF50" 
            scale="0.5 0.5 0.5"
            arjs-anchor="detectedPlanes: true;"
            visible="false"
        >
            <a-animation 
                attribute="rotation"
                to="0 360 0"
                dur="5000"
                repeat="indefinite">
            </a-animation>
        </a-box>
    </a-scene>

    <script>
        // 6. Проверяем загрузку библиотек
        if (!window.AFRAME) {
            document.querySelector('.arjs-loader').innerHTML = 
                'Ошибка: A-Frame не загружен';
            throw new Error('A-Frame not loaded');
        }

        if (!window.ARjs) {
            document.querySelector('.arjs-loader').innerHTML = 
                'Ошибка: AR.js не загружен';
            throw new Error('AR.js not loaded');
        }

        // 7. Инициализация сцены
        document.querySelector('a-scene').addEventListener('loaded', () => {
            document.querySelector('.arjs-loader').style.display = 'none';
            console.log('AR-сцена инициализирована');
        });

        // 8. Интеграция с Telegram
        if (typeof Telegram !== 'undefined') {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        } else {
            console.warn('Telegram WebApp API не найден');
        }
    </script>
</body>
</html>
